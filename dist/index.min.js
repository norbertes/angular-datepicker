"use strict";!function(e){var t=e.module("datePicker",[]);t.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],step:5}),t.filter("time",function(){function e(e){return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}return function(t){return t instanceof Date||(t=new Date(t),!isNaN(t.getTime()))?e(t):void 0}}),t.directive("datePicker",["datePickerConfig","datePickerUtils","$window",function(t,n,a){var i=[],r=[];return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?"},link:function(s,o,d,c){function l(){return"date"!==s.view?s.view:s.date?s.date.getMonth():null}var u=!1;s.date=new Date(s.model||new Date),s.views=t.views.concat(),s.view=d.view||t.view,s.now=new Date,s.template=d.template||t.template,2===r.length&&(i=[],n.dateUpdates=0,r=[]),r.push(s),i.push(s.date.getTime());var g=parseInt(d.step||t.step,10),m=!!d.partial;if(c){if(e.isDefined(d.minDate)){var p;c.$validators.min=function(t){return!n.isValidDate(t)||e.isUndefined(p)||t>=p},d.$observe("minDate",function(e){p=new Date(e),c.$validate()})}if(e.isDefined(d.maxDate)){var f;c.$validators.max=function(t){return!n.isValidDate(t)||e.isUndefined(f)||f>=t},d.$observe("maxDate",function(e){f=new Date(e),c.$validate()})}}s.views=s.views.slice(s.views.indexOf(d.maxView||"year"),s.views.indexOf(d.minView||"minutes")+1),(1===s.views.length||-1===s.views.indexOf(s.view))&&(s.view=s.views[0]),s.setView=function(e){-1!==s.views.indexOf(e)&&(s.view=e)},s.setDate=function(e){var t=(new Date).setHours(0,0,0,0),a=t>e;if(!d.disabled&&!a){n.dateUpdates++,s.date=e;var r=s.views[s.views.indexOf(s.view)+1];if(!r||m||s.model){s.model=new Date(s.model||e),c&&c.$setViewValue(s.date);{m?"minutes":s.view}}r&&s.setView(r),s.$parent.$parent.focused1||s.$parent.$parent.$parent.focused1?(s.$parent.start=s.date,i[0]=s.date.getTime(),s.$parent.$parent.focused1=!1,s.$parent.$parent.focused2=!0,s.$parent.$parent.$parent.focused1=!1,s.$parent.$parent.$parent.focused2=!0):(s.$parent.$parent.focused2||s.$parent.$parent.$parent.focused2)&&(s.$parent.end=s.date,i[1]=s.date.getTime(),i[0]>i[1]&&(i[0]=i[1]),$("body").click()),r||"true"!==d.autoClose||$("body").click()}},s.update=function(){var e=s.view;s.model&&!u&&(s.date=new Date(s.model),u=!1);var t=s.date;switch(e){case"year":s.years=n.getVisibleYears(t);break;case"month":s.months=n.getVisibleMonths(t);break;case"date":s.weekdays=s.weekdays||n.getDaysOfWeek();var r=t;a.outerWidth>=768&&!s.$parent.singleDate&&1===i.indexOf(t.getTime())&&new Date(i[0]).getMonth()===new Date(i[1]).getMonth()&&(r=new Date(t.setMonth(t.getMonth()+1))),s.weeks=n.getVisibleWeeks(t);break;case"hours":s.hours=n.getVisibleHours(t);break;case"minutes":s.minutes=n.getVisibleMinutes(t,g)}},s.$watch(l,s.update),s.go=function(e){r.forEach(function(t,n){t.next(e,n)})},s.next=function(e){var t=s.date;switch(e=e||1,s.view){case"year":case"month":t.setFullYear(t.getFullYear()+e);break;case"date":t.setDate(1),t.setMonth(t.getMonth()+e),s.date=t,s.weeks=n.getVisibleWeeks(t);break;case"hours":case"minutes":t.setHours(t.getHours()+e)}u=!0},s.prev=function(e,t){return s.next(-e||-1,t)},s.isAfter=function(e){return i[0]&&n.isAfter(e,i[0])},s.isBefore=function(e){return i[1]&&n.isBefore(e,i[1])},s.isSameMonth=function(e){return n.isSameMonth(s.model,e)},s.isSameYear=function(e){return n.isSameYear(s.model,e)},s.isSameDay=function(e){return n.isSameDay(s.model,e)},s.isOpening=function(e){var t=new Date(i[0]).setHours(0,0,0,0),n=new Date(e.getTime()).setHours(0,0,0,0);return t===n},s.isClosing=function(e){var t=new Date(i[1]).setHours(0,0,0,0),n=new Date(e).setHours(0,0,0,0);return t===n},s.isSameHour=function(e){return n.isSameHour(s.model,e)},s.isSameMinutes=function(e){return n.isSameMinutes(s.model,e)},s.isNow=function(e){var t=!0,n=s.now;switch(s.view){case"minutes":t&=~~(e.getMinutes()/g)===~~(n.getMinutes()/g);case"hours":t&=e.getHours()===n.getHours();case"date":t&=e.getDate()===n.getDate();case"month":t&=e.getMonth()===n.getMonth();case"year":t&=e.getFullYear()===n.getFullYear()}return t}}}}]),e.module("datePicker").factory("datePickerUtils",function(){var e=function(e){e.setHours(0-e.getTimezoneOffset()/60,0,0,0)};return{dateUpdates:0,getVisibleMinutes:function(e,t){e=new Date(e||new Date),e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());for(var n=[],a=e.getTime()+36e5;e.getTime()<a;)n.push(e),e=new Date(e.getTime()+60*t*1e3);return n},getVisibleWeeks:function(t){t=new Date(t||new Date);var n=t.getMonth(),a=t.getYear();t.setDate(1),e(t),t.setDate(0===t.getDay()?-5:t.getDate()-(t.getDay()-1)),1===t.getDate()&&t.setDate(-6);for(var i=[];i.length<6&&!(t.getYear()===a&&t.getMonth()>n);){for(var r=[],s=0;7>s;s++)r.push(new Date(t)),t.setDate(t.getDate()+1);i.push(r)}return i},getVisibleYears:function(t){var n=[];t=new Date(t||new Date),t.setFullYear(t.getFullYear()-t.getFullYear()%10),t.setMonth(0),t.setDate(1),e(t);for(var a,i=0;12>i;i++)a=new Date(t),a.setFullYear(t.getFullYear()+(i-1)),n.push(a);return n},getDaysOfWeek:function(t){t=new Date(t||new Date),t=new Date(t.getFullYear(),t.getMonth(),t.getDate()),t.setDate(t.getDate()-(t.getDay()-1)),e(t);for(var n=[],a=0;7>a;a++)n.push(new Date(t)),t.setDate(t.getDate()+1);return n},getVisibleMonths:function(t){t=new Date(t||new Date);for(var n,a=t.getFullYear(),i=[],r=0;12>r;r++)n=new Date(a,r,1),e(n),i.push(n);return i},getVisibleHours:function(t){t=new Date(t||new Date),e(t);for(var n=[],a=0;24>a;a++)n.push(t),t=new Date(t.getTime()+36e5);return n},isAfter:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e&&e.getTime()>=t.getTime()},isBefore:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e.getTime()<=t.getTime()},isSameYear:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e&&e.getFullYear()===t.getFullYear()},isSameMonth:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameYear(e,t)&&e.getMonth()===t.getMonth()},isSameDay:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameMonth(e,t)&&e.getDate()===t.getDate()},isSameHour:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameDay(e,t)&&e.getHours()===t.getHours()},isSameMinutes:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameHour(e,t)&&e.getMinutes()===t.getMinutes()},isValidDate:function(e){return e&&!(e.getTime&&e.getTime()!==e.getTime())}}});var t=e.module("datePicker");t.directive("dateRange",["$document","$window","$timeout","datePickerUtils",function(e,t,n,a){return{templateUrl:"templates/daterange.html",scope:{start:"=",end:"=",singleDate:"="},link:function(i,r,s){i.start=new Date(i.start||new Date),i.end=new Date(i.end||new Date),s.$observe("disabled",function(e){i.disableDatePickers=!!e}),i.$watch("start.getTime()",function(e){e&&i.end&&e>new Date(i.end).getTime()&&(i.end=new Date(e))}),i.$watch("end.getTime()",function(e){e&&i.start&&e<i.start.getTime()&&(i.start=new Date(e))}),i.checkVisible=function(){t.outerWidth>=768&&!i.singleDate?(r[0].querySelector('[date-picker="start"]').style.display="block",r[0].querySelector('[date-picker="end"]').style.display="block",r[0].classList.remove("start","end")):i.$parent.focused1||i.$parent.$parent.focused1?(r[0].classList.add("start"),r[0].classList.remove("end"),r[0].querySelector('[date-picker="start"]').style.display="block",r[0].querySelector('[date-picker="end"]').style.display="none"):(i.$parent.focused2||i.$parent.$parent.focused2)&&(r[0].classList.remove("start"),r[0].classList.add("end"),r[0].querySelector('[date-picker="start"]').style.display="none",r[0].querySelector('[date-picker="end"]').style.display="block")};var o=function(e){0===$(e.toElement).parents(".main-search").length&&0===$(e.toElement).parents(".reservation-general__time-limits").length&&(a.dateUpdates=0,$(r).removeClass("showOpacity"),n(function(){$(r).removeClass("show"),i.$parent.focused1=!1,i.$parent.focused2=!1,i.$parent.$parent.focused1=!1,i.$parent.$parent.focused2=!1,i.$parent.showRange=!1,i.$parent.$parent.showBookingRange=!1,i.$parent.$digest()},500))};e.on("click",o),i.$on("$destroy",function(){e.off("click",o)})}}}]);var n="ng-pristine",a="ng-dirty",t=e.module("datePicker");t.constant("dateTimeConfig",{template:function(e){return'<div date-picker="'+e.ngModel+'" '+(e.view?'view="'+e.view+'" ':"")+(e.maxView?'max-view="'+e.maxView+'" ':"")+(e.autoClose?'auto-close="'+e.autoClose+'" ':"")+(e.template?'template="'+e.template+'" ':"")+(e.minView?'min-view="'+e.minView+'" ':"")+(e.partial?'partial="'+e.partial+'" ':"")+(e.step?'step="'+e.step+'" ':"")+'class="date-picker-date-time"></div>'},format:"yyyy-MM-dd HH:mm",views:["date","year","month","hours","minutes"],dismiss:!1,position:"relative"}),t.directive("dateTimeAppend",function(){return{link:function(e,t){t.bind("click",function(){t.find("input")[0].focus()})}}}),t.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function(t,i,r,s,o,d){var c=i.find("body"),l=r("date");return{require:"ngModel",scope:!0,link:function(i,r,u,g){function m(e){return l(e,v)}function p(){return g.$modelValue}function f(e){e.stopPropagation(),g.$pristine&&(g.$dirty=!0,g.$pristine=!1,r.removeClass(n).addClass(a),D&&D.$setDirty(),g.$render())}function h(){M&&(M.remove(),M=null),S&&(S.remove(),S=null)}function w(){if(!M){if(M=t(T)(i),i.$digest(),i.$on("setDate",function(e,t,n){f(e),$&&y[y.length-1]===n&&h()}),i.$on("hidePicker",function(){r.triggerHandler("blur")}),i.$on("$destroy",h),"absolute"===V){var n=e.extend(r.offset(),{height:r[0].offsetHeight});M.css({top:n.top+n.height,left:n.left,display:"block",position:V}),c.append(M)}else S=e.element("<div date-picker-wrapper></div>"),r[0].parentElement.insertBefore(S[0],r[0]),S.append(M),M.css({top:r[0].offsetHeight+"px",display:"block"});M.bind("mousedown",function(e){e.preventDefault()})}}var v=u.format||s.format,D=r.inheritedData("$formController"),y=o(u.views)(i)||s.views.concat(),b=u.view||y[0],k=y.indexOf(b),$=u.dismiss?o(u.dismiss)(i):s.dismiss,M=null,V=u.position||s.position,S=null;if(-1===k&&y.splice(k,1),y.unshift(b),g.$formatters.push(m),g.$parsers.unshift(p),e.isDefined(u.minDate)){var x;g.$validators.min=function(t){return!d.isValidDate(t)||e.isUndefined(x)||t>=x},u.$observe("minDate",function(e){x=new Date(e),g.$validate()})}if(e.isDefined(u.maxDate)){var H;g.$validators.max=function(t){return!d.isValidDate(t)||e.isUndefined(H)||H>=t},u.$observe("maxDate",function(e){H=new Date(e),g.$validate()})}var T=s.template(u);r.bind("focus",w),r.bind("blur",h)}}}]),e.module("datePicker").run(["$templateCache",function(e){e.put("templates/datepicker.html",'<div ng-switch="view">\r\n  <div ng-switch-when="date">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="go(-1)" class="prev-month">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|date:\'yyyy MMMM\'"></th>\r\n        <th ng-click="go(1)" class="next-month">&rsaquo;</i></th>\r\n      </tr>\r\n      <tr>\r\n        <th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|date:\'EEE\'"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr ng-repeat="week in weeks">\r\n        <td ng-repeat="day in week" ng-class="{\'now\':isNow(day),\'opening\':isOpening(day),\'closing\':isClosing(day),\'active\':isSameDay(day),\'disabled\':(day.getMonth()!=date.getMonth()),\'disabled2\':(day.getMonth()!=date.getMonth()+1),\'after\':isAfter(day),\'before\':isBefore(day)}">\r\n          <span\r\n            ng-click="setDate(day)" ng-bind="day.getDate()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="year">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(10)">&lsaquo;</th>\r\n        <th colspan="5" class="switch"ng-bind="years[0].getFullYear()+\' - \'+years[years.length-1].getFullYear()"></th>\r\n        <th ng-click="next(10)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-class="{\'active\':isSameYear(year),\'now\':isNow(year)}"\r\n                ng-repeat="year in years"\r\n                ng-click="setDate(year)" ng-bind="year.getFullYear()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="month">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|date:\'yyyy\'"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="month in months"\r\n                ng-class="{\'active\':isSameMonth(month),\'after\':isAfter(month),\'before\':isBefore(month),\'now\':isNow(month)}"\r\n                ng-click="setDate(month)"\r\n                ng-bind="month|date:\'MMM\'"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="hours">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(24)">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|date:\'dd MMMM yyyy\'"></th>\r\n        <th ng-click="next(24)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="hour in hours"\r\n                ng-class="{\'now\':isNow(hour),\'active\':isSameHour(hour)}"\r\n                ng-click="setDate(hour)" ng-bind="hour|time"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="minutes">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|date:\'dd MMMM yyyy\'"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="minute in minutes"\r\n                ng-class="{active:isSameMinutes(minute),\'now\':isNow(minute)}"\r\n                ng-click="setDate(minute)"\r\n                ng-bind="minute|time"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>\r\n'),e.put("templates/daterange.html",'<div>\r\n    <table>\r\n        <tr>\r\n            <td valign="top" ng-class="{\'visible\':checkVisible()}" >\r\n                <div date-picker="start" ng-disabled="disableDatePickers"  class="date-picker" date after="start" before="end" min-view="date" max-view="date"></div>\r\n            </td>\r\n            <td valign="top" ng-class="{\'visible\':checkVisible()}" >\r\n                <div date-picker="end" ng-disabled="disableDatePickers"  class="date-picker" date after="start" before="end"  min-view="date" max-view="date"></div>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n')}])}(angular);
