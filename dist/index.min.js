"use strict";!function(e){var t=e.module("datePicker",[]);t.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],step:5}),t.filter("time",function(){function e(e){return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}return function(t){return t instanceof Date||(t=new Date(t),!isNaN(t.getTime()))?e(t):void 0}}),t.directive("datePicker",["datePickerConfig","datePickerUtils","$timeout",function(t,n){var a=[],i=[];return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?"},link:function(r,s,o,d){function u(){return"date"!==r.view?r.view:r.date?r.date.getMonth():null}var c=!1;r.date=new Date(r.model||new Date),r.views=t.views.concat(),r.view=o.view||t.view,r.now=new Date,r.template=o.template||t.template,2===i.length&&(a=[],n.dateUpdates=0,i=[]),i.push(r),a.push(r.date.getTime());var l=parseInt(o.step||t.step,10),g=!!o.partial;if(d){if(e.isDefined(o.minDate)){var m;d.$validators.min=function(t){return!n.isValidDate(t)||e.isUndefined(m)||t>=m},o.$observe("minDate",function(e){m=new Date(e),d.$validate()})}if(e.isDefined(o.maxDate)){var f;d.$validators.max=function(t){return!n.isValidDate(t)||e.isUndefined(f)||f>=t},o.$observe("maxDate",function(e){f=new Date(e),d.$validate()})}}r.views=r.views.slice(r.views.indexOf(o.maxView||"year"),r.views.indexOf(o.minView||"minutes")+1),(1===r.views.length||-1===r.views.indexOf(r.view))&&(r.view=r.views[0]),r.setView=function(e){-1!==r.views.indexOf(e)&&(r.view=e)},r.setDate=function(e){if(n.dateUpdates++,!o.disabled){r.date=e;var t=r.views[r.views.indexOf(r.view)+1];if(!t||g||r.model){r.model=new Date(r.model||e),d&&d.$setViewValue(r.date);{g?"minutes":r.view}}t&&r.setView(t),r.$parent.$parent.focused1?(r.$parent.start=r.date,a[0]=r.date.getTime(),r.$parent.$parent.focused1=!1,r.$parent.$parent.focused2=!0):r.$parent.$parent.focused2&&(r.$parent.end=r.date,a[1]=r.date.getTime(),a[0]>a[1]&&(a[0]=a[1]),$("body").click()),t||"true"!==o.autoClose||$("body").click()}},r.update=function(){var e=r.view;r.model&&!c&&(r.date=new Date(r.model),c=!1);var t=r.date;switch(e){case"year":r.years=n.getVisibleYears(t);break;case"month":r.months=n.getVisibleMonths(t);break;case"date":r.weekdays=r.weekdays||n.getDaysOfWeek();var i=t;1===a.indexOf(t.getTime())&&new Date(a[0]).getMonth()===new Date(a[1]).getMonth()&&(i=new Date(t.setMonth(t.getMonth()+1))),r.weeks=n.getVisibleWeeks(t);break;case"hours":r.hours=n.getVisibleHours(t);break;case"minutes":r.minutes=n.getVisibleMinutes(t,l)}},r.$watch(u,r.update),r.go=function(e){i.forEach(function(t,n){t.next(e,n)})},r.next=function(e){var t=r.date;switch(e=e||1,r.view){case"year":case"month":t.setFullYear(t.getFullYear()+e);break;case"date":t.setDate(1),t.setMonth(t.getMonth()+e),r.date=t,r.weeks=n.getVisibleWeeks(t);break;case"hours":case"minutes":t.setHours(t.getHours()+e)}c=!0},r.prev=function(e,t){return r.next(-e||-1,t)},r.isAfter=function(e){return a[0]&&n.isAfter(e,a[0])},r.isBefore=function(e){return a[1]&&n.isBefore(e,a[1])},r.isSameMonth=function(e){return n.isSameMonth(r.model,e)},r.isSameYear=function(e){return n.isSameYear(r.model,e)},r.isSameDay=function(e){return n.isSameDay(r.model,e)},r.isOpening=function(e){var t=new Date(a[0]).setHours(0,0,0,0),n=new Date(e.getTime()).setHours(0,0,0,0);return t===n},r.isClosing=function(e){var t=new Date(a[1]).setHours(0,0,0,0),n=new Date(e).setHours(0,0,0,0);return t===n},r.isSameHour=function(e){return n.isSameHour(r.model,e)},r.isSameMinutes=function(e){return n.isSameMinutes(r.model,e)},r.isNow=function(e){var t=!0,n=r.now;switch(r.view){case"minutes":t&=~~(e.getMinutes()/l)===~~(n.getMinutes()/l);case"hours":t&=e.getHours()===n.getHours();case"date":t&=e.getDate()===n.getDate();case"month":t&=e.getMonth()===n.getMonth();case"year":t&=e.getFullYear()===n.getFullYear()}return t}}}}]),e.module("datePicker").factory("datePickerUtils",function(){var e=function(e){e.setHours(0-e.getTimezoneOffset()/60,0,0,0)};return{dateUpdates:0,getVisibleMinutes:function(e,t){e=new Date(e||new Date),e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());for(var n=[],a=e.getTime()+36e5;e.getTime()<a;)n.push(e),e=new Date(e.getTime()+60*t*1e3);return n},getVisibleWeeks:function(t){t=new Date(t||new Date);var n=t.getMonth(),a=t.getYear();t.setDate(1),e(t),t.setDate(0===t.getDay()?-5:t.getDate()-(t.getDay()-1)),1===t.getDate()&&t.setDate(-6);for(var i=[];i.length<6&&!(t.getYear()===a&&t.getMonth()>n);){for(var r=[],s=0;7>s;s++)r.push(new Date(t)),t.setDate(t.getDate()+1);i.push(r)}return i},getVisibleYears:function(t){var n=[];t=new Date(t||new Date),t.setFullYear(t.getFullYear()-t.getFullYear()%10),t.setMonth(0),t.setDate(1),e(t);for(var a,i=0;12>i;i++)a=new Date(t),a.setFullYear(t.getFullYear()+(i-1)),n.push(a);return n},getDaysOfWeek:function(t){t=new Date(t||new Date),t=new Date(t.getFullYear(),t.getMonth(),t.getDate()),t.setDate(t.getDate()-(t.getDay()-1)),e(t);for(var n=[],a=0;7>a;a++)n.push(new Date(t)),t.setDate(t.getDate()+1);return n},getVisibleMonths:function(t){t=new Date(t||new Date);for(var n,a=t.getFullYear(),i=[],r=0;12>r;r++)n=new Date(a,r,1),e(n),i.push(n);return i},getVisibleHours:function(t){t=new Date(t||new Date),e(t);for(var n=[],a=0;24>a;a++)n.push(t),t=new Date(t.getTime()+36e5);return n},isAfter:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e&&e.getTime()>=t.getTime()},isBefore:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e.getTime()<=t.getTime()},isSameYear:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e&&e.getFullYear()===t.getFullYear()},isSameMonth:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameYear(e,t)&&e.getMonth()===t.getMonth()},isSameDay:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameMonth(e,t)&&e.getDate()===t.getDate()},isSameHour:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameDay(e,t)&&e.getHours()===t.getHours()},isSameMinutes:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameHour(e,t)&&e.getMinutes()===t.getMinutes()},isValidDate:function(e){return e&&!(e.getTime&&e.getTime()!==e.getTime())}}});var t=e.module("datePicker");t.directive("dateRange",["$document","$timeout","datePickerUtils",function(e,t,n){return{templateUrl:"templates/daterange.html",scope:{start:"=",end:"="},link:function(a,i,r){a.start=new Date(a.start||new Date),a.end=new Date(a.end||new Date),r.$observe("disabled",function(e){a.disableDatePickers=!!e}),a.$watch("start.getTime()",function(e){e&&a.end&&e>new Date(a.end).getTime()&&(a.end=new Date(e))}),a.$watch("end.getTime()",function(e){e&&a.start&&e<a.start.getTime()&&(a.start=new Date(e))});var s=function(e){0===$(e.toElement).parents(".main-search").length&&(n.dateUpdates=0,$(i).removeClass("showOpacity"),t(function(){$(i).removeClass("show"),a.$parent.focused1=!1,a.$parent.focused2=!1,a.$parent.showRange=!1,a.$parent.$digest()},500))};e.on("click",s),a.$on("$destroy",function(){e.off("click",s)})}}}]);var n="ng-pristine",a="ng-dirty",t=e.module("datePicker");t.constant("dateTimeConfig",{template:function(e){return'<div date-picker="'+e.ngModel+'" '+(e.view?'view="'+e.view+'" ':"")+(e.maxView?'max-view="'+e.maxView+'" ':"")+(e.autoClose?'auto-close="'+e.autoClose+'" ':"")+(e.template?'template="'+e.template+'" ':"")+(e.minView?'min-view="'+e.minView+'" ':"")+(e.partial?'partial="'+e.partial+'" ':"")+(e.step?'step="'+e.step+'" ':"")+'class="date-picker-date-time"></div>'},format:"yyyy-MM-dd HH:mm",views:["date","year","month","hours","minutes"],dismiss:!1,position:"relative"}),t.directive("dateTimeAppend",function(){return{link:function(e,t){t.bind("click",function(){t.find("input")[0].focus()})}}}),t.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function(t,i,r,s,o,d){var u=i.find("body"),c=r("date");return{require:"ngModel",scope:!0,link:function(i,r,l,g){function m(e){return c(e,p)}function f(){return g.$modelValue}function h(e){e.stopPropagation(),g.$pristine&&(g.$dirty=!0,g.$pristine=!1,r.removeClass(n).addClass(a),D&&D.$setDirty(),g.$render())}function w(){M&&(M.remove(),M=null),x&&(x.remove(),x=null)}function v(){if(!M){if(M=t(H)(i),i.$digest(),i.$on("setDate",function(e,t,n){h(e),$&&y[y.length-1]===n&&w()}),i.$on("hidePicker",function(){r.triggerHandler("blur")}),i.$on("$destroy",w),"absolute"===V){var n=e.extend(r.offset(),{height:r[0].offsetHeight});M.css({top:n.top+n.height,left:n.left,display:"block",position:V}),u.append(M)}else x=e.element("<div date-picker-wrapper></div>"),r[0].parentElement.insertBefore(x[0],r[0]),x.append(M),M.css({top:r[0].offsetHeight+"px",display:"block"});M.bind("mousedown",function(e){e.preventDefault()})}}var p=l.format||s.format,D=r.inheritedData("$formController"),y=o(l.views)(i)||s.views.concat(),b=l.view||y[0],k=y.indexOf(b),$=l.dismiss?o(l.dismiss)(i):s.dismiss,M=null,V=l.position||s.position,x=null;if(-1===k&&y.splice(k,1),y.unshift(b),g.$formatters.push(m),g.$parsers.unshift(f),e.isDefined(l.minDate)){var T;g.$validators.min=function(t){return!d.isValidDate(t)||e.isUndefined(T)||t>=T},l.$observe("minDate",function(e){T=new Date(e),g.$validate()})}if(e.isDefined(l.maxDate)){var Y;g.$validators.max=function(t){return!d.isValidDate(t)||e.isUndefined(Y)||Y>=t},l.$observe("maxDate",function(e){Y=new Date(e),g.$validate()})}var H=s.template(l);r.bind("focus",v),r.bind("blur",w)}}}]),e.module("datePicker").run(["$templateCache",function(e){e.put("templates/datepicker.html",'<div ng-switch="view">\r\n  <div ng-switch-when="date">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="go(-1)" class="prev-month">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|date:\'yyyy MMMM\'"></th>\r\n        <th ng-click="go(1)" class="next-month">&rsaquo;</i></th>\r\n      </tr>\r\n      <tr>\r\n        <th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|date:\'EEE\'"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr ng-repeat="week in weeks">\r\n        <td ng-repeat="day in week" ng-class="{\'now\':isNow(day),\'opening\':isOpening(day),\'closing\':isClosing(day),\'active\':isSameDay(day),\'disabled\':(day.getMonth()!=date.getMonth()),\'disabled2\':(day.getMonth()!=date.getMonth()+1),\'after\':isAfter(day),\'before\':isBefore(day)}">\r\n          <span\r\n            ng-click="setDate(day)" ng-bind="day.getDate()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="year">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(10)">&lsaquo;</th>\r\n        <th colspan="5" class="switch"ng-bind="years[0].getFullYear()+\' - \'+years[years.length-1].getFullYear()"></th>\r\n        <th ng-click="next(10)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-class="{\'active\':isSameYear(year),\'now\':isNow(year)}"\r\n                ng-repeat="year in years"\r\n                ng-click="setDate(year)" ng-bind="year.getFullYear()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="month">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|date:\'yyyy\'"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="month in months"\r\n                ng-class="{\'active\':isSameMonth(month),\'after\':isAfter(month),\'before\':isBefore(month),\'now\':isNow(month)}"\r\n                ng-click="setDate(month)"\r\n                ng-bind="month|date:\'MMM\'"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="hours">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(24)">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|date:\'dd MMMM yyyy\'"></th>\r\n        <th ng-click="next(24)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="hour in hours"\r\n                ng-class="{\'now\':isNow(hour),\'active\':isSameHour(hour)}"\r\n                ng-click="setDate(hour)" ng-bind="hour|time"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="minutes">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|date:\'dd MMMM yyyy\'"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="minute in minutes"\r\n                ng-class="{active:isSameMinutes(minute),\'now\':isNow(minute)}"\r\n                ng-click="setDate(minute)"\r\n                ng-bind="minute|time"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>\r\n'),e.put("templates/daterange.html",'<div>\r\n    <table>\r\n        <tr>\r\n            <td valign="top">\r\n                <div date-picker="start" ng-disabled="disableDatePickers"  class="date-picker" date after="start" before="end" min-view="date" max-view="date"></div>\r\n            </td>\r\n            <td valign="top">\r\n                <div date-picker="end" ng-disabled="disableDatePickers"  class="date-picker" date after="start" before="end"  min-view="date" max-view="date"></div>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n')}])}(angular);
