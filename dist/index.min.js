"use strict";!function(e){var t=e.module("datePicker",[]);t.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],step:5}),t.filter("time",function(){function e(e){return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}return function(t){return t instanceof Date||(t=new Date(t),!isNaN(t.getTime()))?e(t):void 0}}),t.directive("datePicker",["datePickerConfig","datePickerUtils",function(t,n){var a=[],i=0,r=[];return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?"},link:function(s,o,d,u){function l(){return"date"!==s.view?s.view:s.date?s.date.getMonth():null}var c=!1;s.date=new Date(s.model||new Date),s.views=t.views.concat(),s.view=d.view||t.view,s.now=new Date,s.template=d.template||t.template,2===r.length&&(a=[],i=0,r=[]),r.push(s),a.push(s.date.getTime());var g=parseInt(d.step||t.step,10),m=!!d.partial;if(u){if(e.isDefined(d.minDate)){var h;u.$validators.min=function(t){return!n.isValidDate(t)||e.isUndefined(h)||t>=h},d.$observe("minDate",function(e){h=new Date(e),u.$validate()})}if(e.isDefined(d.maxDate)){var w;u.$validators.max=function(t){return!n.isValidDate(t)||e.isUndefined(w)||w>=t},d.$observe("maxDate",function(e){w=new Date(e),u.$validate()})}}s.views=s.views.slice(s.views.indexOf(d.maxView||"year"),s.views.indexOf(d.minView||"minutes")+1),(1===s.views.length||-1===s.views.indexOf(s.view))&&(s.view=s.views[0]),s.setView=function(e){-1!==s.views.indexOf(e)&&(s.view=e)},s.setDate=function(e){if(i++,!d.disabled){s.date=e;var t=s.views[s.views.indexOf(s.view)+1];if(!t||m||s.model){s.model=new Date(s.model||e),u&&u.$setViewValue(s.date);{m?"minutes":s.view}}t&&s.setView(t),i%2===1?(s.$parent.start=s.date,a[0]=s.date.getTime(),s.$parent.end=a[1]=s.date.getTime()):i%2===0&&(s.$parent.end=s.date,a[1]=s.date.getTime(),$(o.parents(".date-range")).scope().showRange=!1),t||"true"!==d.autoClose||(o.addClass("hidden"),s.$emit("hidePicker"))}},s.update=function(){var e=s.view;s.model&&!c&&(s.date=new Date(s.model),c=!1);var t=s.date;switch(e){case"year":s.years=n.getVisibleYears(t);break;case"month":s.months=n.getVisibleMonths(t);break;case"date":s.weekdays=s.weekdays||n.getDaysOfWeek();var i=t;1===a.indexOf(t.getTime())&&new Date(a[0]).getMonth()===new Date(a[1]).getMonth()&&(i=new Date(t.setMonth(t.getMonth()+1))),s.weeks=n.getVisibleWeeks(t);break;case"hours":s.hours=n.getVisibleHours(t);break;case"minutes":s.minutes=n.getVisibleMinutes(t,g)}},s.$watch(l,s.update),s.go=function(e){r.forEach(function(t,n){t.next(e,n)})},s.next=function(e){var t=s.date;switch(e=e||1,s.view){case"year":case"month":t.setFullYear(t.getFullYear()+e);break;case"date":t.setDate(1),t.setMonth(t.getMonth()+e),s.date=t,s.weeks=n.getVisibleWeeks(t);break;case"hours":case"minutes":t.setHours(t.getHours()+e)}c=!0},s.prev=function(e,t){return s.next(-e||-1,t)},s.isAfter=function(e){return a[0]&&n.isAfter(e,a[0])},s.isBefore=function(e){return a[1]&&n.isBefore(e,a[1])},s.isSameMonth=function(e){return n.isSameMonth(s.model,e)},s.isSameYear=function(e){return n.isSameYear(s.model,e)},s.isSameDay=function(e){return n.isSameDay(s.model,e)},s.isOpening=function(e){var t=new Date(a[0]).setHours(0,0,0,0),n=new Date(e.getTime()).setHours(0,0,0,0);return t===n},s.isClosing=function(e){var t=new Date(a[1]).setHours(0,0,0,0),n=new Date(e).setHours(0,0,0,0);return t===n},s.isSameHour=function(e){return n.isSameHour(s.model,e)},s.isSameMinutes=function(e){return n.isSameMinutes(s.model,e)},s.isNow=function(e){var t=!0,n=s.now;switch(s.view){case"minutes":t&=~~(e.getMinutes()/g)===~~(n.getMinutes()/g);case"hours":t&=e.getHours()===n.getHours();case"date":t&=e.getDate()===n.getDate();case"month":t&=e.getMonth()===n.getMonth();case"year":t&=e.getFullYear()===n.getFullYear()}return t}}}}]),e.module("datePicker").factory("datePickerUtils",function(){var e=function(e){e.setHours(0-e.getTimezoneOffset()/60,0,0,0)};return{getVisibleMinutes:function(e,t){e=new Date(e||new Date),e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());for(var n=[],a=e.getTime()+36e5;e.getTime()<a;)n.push(e),e=new Date(e.getTime()+60*t*1e3);return n},getVisibleWeeks:function(t){t=new Date(t||new Date);var n=t.getMonth(),a=t.getYear();t.setDate(1),e(t),t.setDate(0===t.getDay()?-5:t.getDate()-(t.getDay()-1)),1===t.getDate()&&t.setDate(-6);for(var i=[];i.length<6&&!(t.getYear()===a&&t.getMonth()>n);){for(var r=[],s=0;7>s;s++)r.push(new Date(t)),t.setDate(t.getDate()+1);i.push(r)}return i},getVisibleYears:function(t){var n=[];t=new Date(t||new Date),t.setFullYear(t.getFullYear()-t.getFullYear()%10),t.setMonth(0),t.setDate(1),e(t);for(var a,i=0;12>i;i++)a=new Date(t),a.setFullYear(t.getFullYear()+(i-1)),n.push(a);return n},getDaysOfWeek:function(t){t=new Date(t||new Date),t=new Date(t.getFullYear(),t.getMonth(),t.getDate()),t.setDate(t.getDate()-(t.getDay()-1)),e(t);for(var n=[],a=0;7>a;a++)n.push(new Date(t)),t.setDate(t.getDate()+1);return n},getVisibleMonths:function(t){t=new Date(t||new Date);for(var n,a=t.getFullYear(),i=[],r=0;12>r;r++)n=new Date(a,r,1),e(n),i.push(n);return i},getVisibleHours:function(t){t=new Date(t||new Date),e(t);for(var n=[],a=0;24>a;a++)n.push(t),t=new Date(t.getTime()+36e5);return n},isAfter:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e&&e.getTime()>=t.getTime()},isBefore:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e.getTime()<=t.getTime()},isSameYear:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),e&&e.getFullYear()===t.getFullYear()},isSameMonth:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameYear(e,t)&&e.getMonth()===t.getMonth()},isSameDay:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameMonth(e,t)&&e.getDate()===t.getDate()},isSameHour:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameDay(e,t)&&e.getHours()===t.getHours()},isSameMinutes:function(e,t){return e=void 0!==e?new Date(e):e,t=new Date(t),this.isSameHour(e,t)&&e.getMinutes()===t.getMinutes()},isValidDate:function(e){return e&&!(e.getTime&&e.getTime()!==e.getTime())}}});var t=e.module("datePicker");t.directive("dateRange",["$document","$timeout",function(e,t){return{templateUrl:"templates/daterange.html",scope:{start:"=",end:"="},link:function(n,a,i){n.start=new Date(n.start||new Date),n.end=new Date(n.end||new Date),i.$observe("disabled",function(e){n.disableDatePickers=!!e}),n.$watch("start.getTime()",function(e){e&&n.end&&e>new Date(n.end).getTime()&&(n.end=new Date(e))}),n.$watch("end.getTime()",function(e){e&&n.start&&e<n.start.getTime()&&(n.start=new Date(e))});var r=function(e){0===$(e.toElement).parents(".main-search").length&&($(a).removeClass("showOpacity"),t(function(){$(a).removeClass("show"),n.$parent.showRange=!1,n.$parent.$digest()},450))};e.on("click",r),n.$on("$destroy",function(){e.off("click",r)})}}}]);var n="ng-pristine",a="ng-dirty",t=e.module("datePicker");t.constant("dateTimeConfig",{template:function(e){return'<div date-picker="'+e.ngModel+'" '+(e.view?'view="'+e.view+'" ':"")+(e.maxView?'max-view="'+e.maxView+'" ':"")+(e.autoClose?'auto-close="'+e.autoClose+'" ':"")+(e.template?'template="'+e.template+'" ':"")+(e.minView?'min-view="'+e.minView+'" ':"")+(e.partial?'partial="'+e.partial+'" ':"")+(e.step?'step="'+e.step+'" ':"")+'class="date-picker-date-time"></div>'},format:"yyyy-MM-dd HH:mm",views:["date","year","month","hours","minutes"],dismiss:!1,position:"relative"}),t.directive("dateTimeAppend",function(){return{link:function(e,t){t.bind("click",function(){t.find("input")[0].focus()})}}}),t.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function(t,i,r,s,o,d){var u=i.find("body"),l=r("date");return{require:"ngModel",scope:!0,link:function(i,r,c,g){function m(e){return l(e,p)}function h(){return g.$modelValue}function w(e){e.stopPropagation(),g.$pristine&&(g.$dirty=!0,g.$pristine=!1,r.removeClass(n).addClass(a),D&&D.$setDirty(),g.$render())}function f(){$&&($.remove(),$=null),x&&(x.remove(),x=null)}function v(){if(!$){if($=t(H)(i),i.$digest(),i.$on("setDate",function(e,t,n){w(e),M&&y[y.length-1]===n&&f()}),i.$on("hidePicker",function(){r.triggerHandler("blur")}),i.$on("$destroy",f),"absolute"===V){var n=e.extend(r.offset(),{height:r[0].offsetHeight});$.css({top:n.top+n.height,left:n.left,display:"block",position:V}),u.append($)}else x=e.element("<div date-picker-wrapper></div>"),r[0].parentElement.insertBefore(x[0],r[0]),x.append($),$.css({top:r[0].offsetHeight+"px",display:"block"});$.bind("mousedown",function(e){e.preventDefault()})}}var p=c.format||s.format,D=r.inheritedData("$formController"),y=o(c.views)(i)||s.views.concat(),b=c.view||y[0],k=y.indexOf(b),M=c.dismiss?o(c.dismiss)(i):s.dismiss,$=null,V=c.position||s.position,x=null;if(-1===k&&y.splice(k,1),y.unshift(b),g.$formatters.push(m),g.$parsers.unshift(h),e.isDefined(c.minDate)){var T;g.$validators.min=function(t){return!d.isValidDate(t)||e.isUndefined(T)||t>=T},c.$observe("minDate",function(e){T=new Date(e),g.$validate()})}if(e.isDefined(c.maxDate)){var Y;g.$validators.max=function(t){return!d.isValidDate(t)||e.isUndefined(Y)||Y>=t},c.$observe("maxDate",function(e){Y=new Date(e),g.$validate()})}var H=s.template(c);r.bind("focus",v),r.bind("blur",f)}}}]),e.module("datePicker").run(["$templateCache",function(e){e.put("templates/datepicker.html",'<div ng-switch="view">\r\n  <div ng-switch-when="date">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="go(-1)" class="prev-month">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'month\')" ng-bind="date|date:\'yyyy MMMM\'"></th>\r\n        <th ng-click="go(1)" class="next-month">&rsaquo;</i></th>\r\n      </tr>\r\n      <tr>\r\n        <th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|date:\'EEE\'"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr ng-repeat="week in weeks">\r\n        <td ng-repeat="day in week" ng-class="{\'now\':isNow(day),\'opening\':isOpening(day),\'closing\':isClosing(day),\'active\':isSameDay(day),\'disabled\':(day.getMonth()!=date.getMonth()),\'disabled2\':(day.getMonth()!=date.getMonth()+1),\'after\':isAfter(day),\'before\':isBefore(day)}">\r\n          <span\r\n            ng-click="setDate(day)" ng-bind="day.getDate()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="year">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(10)">&lsaquo;</th>\r\n        <th colspan="5" class="switch"ng-bind="years[0].getFullYear()+\' - \'+years[years.length-1].getFullYear()"></th>\r\n        <th ng-click="next(10)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-class="{\'active\':isSameYear(year),\'now\':isNow(year)}"\r\n                ng-repeat="year in years"\r\n                ng-click="setDate(year)" ng-bind="year.getFullYear()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="month">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'year\')" ng-bind="date|date:\'yyyy\'"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="month in months"\r\n                ng-class="{\'active\':isSameMonth(month),\'after\':isAfter(month),\'before\':isBefore(month),\'now\':isNow(month)}"\r\n                ng-click="setDate(month)"\r\n                ng-bind="month|date:\'MMM\'"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="hours">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev(24)">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'date\')" ng-bind="date|date:\'dd MMMM yyyy\'"></th>\r\n        <th ng-click="next(24)">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="hour in hours"\r\n                ng-class="{\'now\':isNow(hour),\'active\':isSameHour(hour)}"\r\n                ng-click="setDate(hour)" ng-bind="hour|time"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div ng-switch-when="minutes">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th ng-click="prev()">&lsaquo;</th>\r\n        <th colspan="5" class="switch" ng-click="setView(\'hours\')" ng-bind="date|date:\'dd MMMM yyyy\'"></th>\r\n        <th ng-click="next()">&rsaquo;</i></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="minute in minutes"\r\n                ng-class="{active:isSameMinutes(minute),\'now\':isNow(minute)}"\r\n                ng-click="setDate(minute)"\r\n                ng-bind="minute|time"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>\r\n'),e.put("templates/daterange.html",'<div>\r\n    <table>\r\n        <tr>\r\n            <td valign="top">\r\n                <div date-picker="start" ng-disabled="disableDatePickers"  class="date-picker" date after="start" before="end" min-view="date" max-view="date"></div>\r\n            </td>\r\n            <td valign="top">\r\n                <div date-picker="end" ng-disabled="disableDatePickers"  class="date-picker" date after="start" before="end"  min-view="date" max-view="date"></div>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n')}])}(angular);
